define(["jquery","core/config","local_competvetsuivi/config","d3","d3-progress"],function(a,b,c,d,e){return{default_padding:{top:10,right:5,bottom:1,left:5},default_progress_chart_height:100,default_doghnut_chart_height:400,progress_charts:function(b,c,f){this.load_css("/local/competvetsuivi/js/d3-libraries/progress/d3-progress.css");var g="#"+b,h=a(g).first(),i=this,j=function(){var a=h.parent().innerWidth(),b=i.default_progress_chart_height;f&&void 0!==f.size&&(void 0!==f.size.height&&(b=f.size.height?f.size.height:h.height()),void 0!==f.size.width&&(a=f.size.width?f.size.width:a));var j=e.progress().width(a).height(b).data(c);d.select(g).call(j)};a(document).ready(j),a(window).bind("resize",function(){a(h).empty(),j()})},ring_charts:function(b,c,e){var f=this;f.add_patterns_definitions();var g="#"+b,h=a(g).first(),i=f.default_padding,j=function(){var a=h.parent().innerWidth(),b=h.parent().innerHeight();e&&(void 0!==e.size&&(void 0!==e.size.height&&(b=e.size.height?e.size.height:h.height()),void 0!==e.size.width&&(a=e.size.width?e.size.width:a)),void 0!==e.padding&&void 0!==e.padding.top&&void 0!==e.padding.left&&void 0!==e.padding.right&&void 0!==e.padding.bottom&&(i=e.padding));var f=Math.min(a,b)/3,j=parseInt(h.css("font-size")),k=d.arc().outerRadius(f-10).innerRadius(f/1.5),l=d.arc().outerRadius(1.2*f).innerRadius(1.2*f-j),m=d.arc().outerRadius(1.5*f).innerRadius(1.5*f-j),n=d.select(g).attr("width",a).attr("height",b).append("g").attr("transform","translate("+(a/2+i.left)+","+(b/2+i.top)+")"),o=d.pie().value(function(a){return a.val}).sort(null),p=o(Object.values(c.compsvalues)),q=n.selectAll(".arc").data(p).enter().append("g").attr("class","arc");q.append("path").attr("d",k).attr("class",function(a){return"macrocomp-"+a.data.colorindex+" arc-bg"});var r=function(a){var b=a.endAngle-a.startAngle,d=Object.assign({},a),e="undefined"!==a.data.strandvals[c.overlaystrandid]?a.data.strandvals[c.overlaystrandid].val:0;return d.endAngle=a.startAngle+e*b,k(d)};q.append("path").attr("d",function(a){return r(a)}).attr("fill","url(#d3utils-whitecarbon)").attr("fill-opacity","60%"),n.append("g").classed("lines",!0),n.append("g").classed("labels",!0);var s=Array.from(p).map(function(a,b){var c=b%2?l:m,d=c.centroid(a),e=a.startAngle+(a.endAngle-a.startAngle)/2,g=e<Math.PI?1:-1,h=b%4+1;return d[0]=f*h*g/1.5,d});n.select(".lines").selectAll("polyline").data(p).enter().append("polyline").attr("stroke","lightgray").style("fill","none").attr("stroke-width",1).attr("points",function(a,b){var c=b%2?l:m,d=k.centroid(a),e=c.centroid(a),f=s[b];return f[0]=.85*f[0],[d,e,f]});var t=n.select(".labels").selectAll("text").data(p).enter().append("text").attr("transform",function(a,b){var c=s[b];return c[0]=.99*c[0],"translate("+c+")"});t.append("tspan").text(function(a){return a.data.shortname+" - "+Math.round(100*a.data.val)+"%"}).attr("class","sn-label").style("text-anchor",function(a){var b=a.startAngle+(a.endAngle-a.startAngle)/2;return b<Math.PI?"start":"end"}),t.append("tspan").text(function(a){return a.data.fullname}).attr("class","fn-label").attr("dy","1em").attr("x","0").style("text-anchor",function(a){var b=a.startAngle+(a.endAngle-a.startAngle)/2;return b<Math.PI?"start":"end"})};a(document).ready(j),a(window).bind("resize",function(){a(h).empty(),j()})},load_css:function(a){var c=document.createElement("link");c.type="text/css",c.rel="stylesheet",c.href=b.wwwroot+a,document.getElementsByTagName("head")[0].appendChild(c)},add_patterns_definitions:function(){var a=[{pattername:"d3utils-whitecarbon",imagedef:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHhtbG5zOnhsaW5rPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJyB3aWR0aD0nNicgaGVpZ2h0PSc2Jz4KICA8cmVjdCB3aWR0aD0nNicgaGVpZ2h0PSc2JyBmaWxsPScjZWVlZWVlJy8+CiAgPGcgaWQ9J2MnPgogICAgPHJlY3Qgd2lkdGg9JzMnIGhlaWdodD0nMycgZmlsbD0nI2U2ZTZlNicvPgogICAgPHJlY3QgeT0nMScgd2lkdGg9JzMnIGhlaWdodD0nMicgZmlsbD0nI2Q4ZDhkOCcvPgogIDwvZz4KICA8dXNlIHhsaW5rOmhyZWY9JyNjJyB4PSczJyB5PSczJy8+Cjwvc3ZnPg=="}],b=d.select("body").select("svg#d3progresspatternsdef");b.empty()&&d.select("body").append("svg").attr("id","d3utilspatternsdef").append("defs").selectAll("pattern").data(a).enter().append("pattern").attr("id",function(a){return a.pattername}).attr("patternUnits","userSpaceOnUse").attr("width",10).attr("height",10).append("image").attr("xlink:href",function(a){return a.imagedef}).attr("x",0).attr("y",0).attr("width",10).attr("height",10)}}});