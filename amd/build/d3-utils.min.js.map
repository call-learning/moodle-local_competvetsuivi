{"version":3,"sources":["../src/d3-utils.js"],"names":["define","$","cfg","requirejsd3","require","config","paths","wwwroot","jsrev","developerdebug","map","shim","deps","exports","default_padding","top","right","bottom","left","default_progress_chart_height","default_doghnut_chart_height","progress_charts","svgid","data","paddingandsize","load_css","d3","d3progress","svgselector","svgelement","first","thisutils","display_chart","width","parent","innerWidth","height","size","chart","progress","select","call","document","ready","window","bind","empty","ring_charts","add_doghnut_patterns_definitions","padding","innerHeight","radius","Math","min","arc","outerRadius","innerRadius","svg","attr","append","pie","value","d","val","sort","d3piedata","Object","values","compsvalues","g","selectAll","enter","colorindex","calulateOverlayArc","anglediff","endAngle","startAngle","modifieddata","assign","overlaystrandval","strandvals","overlaystrandid","centroid","style","text","rval","round","path","globalpath","length","link","createElement","type","rel","href","getElementsByTagName","appendChild","svgpattern","pattername","imagedef"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * D3 Utils\n *\n * @package     local_competvetsuivi\n * @copyright   2019 CALL Learning <laurent@call-learning.fr>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/config'],\n    function($, cfg) {\n        var requirejsd3 = require.config({\n            paths: {\n                \"d3-progress\": cfg.wwwroot\n                    + '/lib/javascript.php/'\n                    + cfg.jsrev\n                    + '/local/competvetsuivi/js/d3-libraries/progress/d3-progress'\n                    + (cfg.developerdebug ? '.min' : ''),\n                \"d3\": cfg.wwwroot\n                    + '/lib/javascript.php/'\n                    + cfg.jsrev\n                    + '/local/competvetsuivi/js/d3/d3'\n                    + (cfg.developerdebug ? '.min' : ''),\n            },\n            map: {\n                'd3-progress': {\n                    'd3-axis': 'd3',\n                    'd3-scale': 'd3',\n                    'd3-format': 'd3',\n                    'd3-transition': 'd3',\n                    'd3-shape': 'd3',\n                    'd3-selection': 'd3',\n                }\n            },\n            shim: {\n                'd3-progress': {\n                    deps: ['d3', 'd3-axis', 'd3-scale', 'd3-format', 'd3-transition', 'd3-shape', 'd3-selection'],\n                },\n                'd3': {\n                    exports: 'd3'\n                },\n            }\n        });\n        return {\n            default_padding: {top: 10, right: 5, bottom: 1, left: 5},\n            default_progress_chart_height: 125,\n            default_doghnut_chart_height: 400,\n\n            /**\n             *\n             * @param svgid SVG item to draw the graph into\n             * @param data : an array of data\n             * @param paddingandsize: optional padding and size parameter\n             */\n            progress_charts: function(svgid, data, paddingandsize) {\n                this.load_css('/local/competvetsuivi/js/d3-libraries/progress/d3-progress.css');\n                requirejsd3(['d3', 'd3-progress'], function(d3,d3progress) {\n                    var svgselector = '#' + svgid;\n                    var svgelement = $(svgselector).first();\n                    var thisutils = this;\n                    var display_chart = function () {\n                        var width = svgelement.parent().innerWidth();\n                        var height = thisutils.default_progress_chart_height;\n                        if (paddingandsize) {\n                            if (paddingandsize.size !== undefined) {\n                                if (paddingandsize.size.height !== undefined && paddingandsize.size.height != 0) {\n                                    // If set to 0 then autosize it\n                                    height = paddingandsize.size.height ? paddingandsize.size.height : svgelement.height();\n                                }\n                                if (paddingandsize.size.width !== undefined && paddingandsize.size.height != 0) {\n                                    // If set to 0 then autosize it\n                                    width = paddingandsize.size.width ? paddingandsize.size.width : width;\n                                }\n\n                            }\n                        }\n                        var chart = d3progress.progress()\n                            .width(width)\n                            .height(height)\n                            .data(data);\n                        d3.select(svgselector)\n                            .call(chart);\n                    };\n                    $(document).ready(display_chart);\n                    $(window).bind('resize', function () {\n                        $(svgelement).empty();\n                        display_chart();\n                    });\n                });\n            },\n\n            /**\n             *\n             * @param svgid SVG item to draw the graph into\n             * @param data : an array of data\n             * @param paddingandsize: optional padding and size parameter\n             */\n            ring_charts: function(svgid, data, paddingandsize) {\n                var thisutils = this;\n                this.load_css('/local/competvetsuivi/js/d3-libraries/progress/d3-progress.css');\n                requirejsd3(['d3'], function(d3) {\n                    thisutils.add_doghnut_patterns_definitions(d3);\n                    var svgselector = '#' + svgid;\n                    var svgelement = $(svgselector).first();\n                    var padding = thisutils.default_padding;\n                    var display_chart = function () {\n\n                        var width = svgelement.parent().innerWidth();\n                        var height = svgelement.parent().innerHeight();\n\n                        if (paddingandsize) {\n                            if (paddingandsize.size !== undefined) {\n                                if (paddingandsize.size.height !== undefined && paddingandsize.size.height != 0) {\n                                    // If set to 0 then autosize it\n                                    height = paddingandsize.size.height ? paddingandsize.size.height : svgelement.height();\n                                }\n                                if (paddingandsize.size.width !== undefined && paddingandsize.size.width != 0) {\n                                    // If set to 0 then autosize it\n                                    width = paddingandsize.size.width ? paddingandsize.size.width : width;\n                                }\n                            }\n                            if (paddingandsize.padding !== undefined\n                                && paddingandsize.padding.top !== undefined\n                                && paddingandsize.padding.left !== undefined\n                                && paddingandsize.padding.right !== undefined\n                                && paddingandsize.padding.bottom !== undefined) {\n                                padding = paddingandsize.padding;\n                            }\n\n                        }\n                        var radius = Math.min(width, height) / 2;\n\n                        var arc = d3.arc()\n                            .outerRadius(radius - 10)\n                            .innerRadius(radius / 1.3);\n                        // Create the basic drawing / container\n                        var svg = d3.select(svgselector).attr(\"width\", width)\n                            .attr(\"height\", height)\n                            .append(\"g\")\n                            .attr(\"transform\", \"translate(\" + (width / 2 + padding.left)\n                                + \",\" + (height / 2 + padding.top) + \")\");\n\n                        // Pie chart return just the value\n                        var pie = d3.pie().value(function (d) {\n                            return d.val;\n                        }).sort(null);\n                        // Rearrange data so we get big + small values interleaved, this is to make sure labels\n                        // are not to close to each other\n                        var d3piedata = pie(Object.values(data.compsvalues));\n\n                        var g = svg.selectAll(\".arc\")\n                            .data(d3piedata)\n                            .enter()\n                            .append(\"g\")\n                            .attr(\"class\", \"arc\");\n\n                        // Draw, Style and color the arc\n                        g.append(\"path\")\n                            .attr(\"d\", arc)\n                            .attr(\"class\", function (d) {\n                                return 'macrocomp-' + d.data.colorindex + ' arc-bg';\n                            });\n                        var calulateOverlayArc = function (d) {\n                            var anglediff = d.endAngle - d.startAngle;\n                            var modifieddata = Object.assign({}, d); // Assuming copy on write (at first level of nesting)\n                            var overlaystrandval = d.data.strandvals[data.overlaystrandid] !== 'undefined' ?\n                                d.data.strandvals[data.overlaystrandid].val : 0;\n                            modifieddata.endAngle = d.startAngle + overlaystrandval * anglediff;\n                            return arc(modifieddata);\n                        };\n                        g.append(\"path\")\n                            .attr(\"d\", function (d) {\n                                return calulateOverlayArc(d);\n                            })\n                            .attr(\"fill\", function () {\n                                return 'url(#doghnut-p' + data.overlaystrandid + ')';\n                            })\n                            .attr(\"fill-opacity\", '60%');\n                        // Add the percent on the label\n                        g.append(\"text\")\n                            .attr(\"class\", \"doghnut-text-percent\")\n                            .attr(\"transform\", function (d) {\n                                var d = arc.centroid(d);\n                                d[0] *= 0.6;\n                                d[1] *= 0.6;\n                                return \"translate(\" + d + \")\";\n                            })\n                            .attr(\"dy\", \".50em\")\n                            .style(\"text-anchor\", \"middle\")\n                            .text(function (d) {\n                                var rval = Math.round(d.value * 100);\n                                if (rval < 10) {\n                                    return '';\n                                }\n                                return rval + '%';\n                            });\n                    };\n                    $(document).ready(display_chart);\n                    $(window).bind('resize', function () {\n                        $(svgelement).empty();\n                        display_chart();\n                    });\n                });\n            },\n            load_css: function (path) {\n                var globalpath = cfg.wwwroot + path;\n                if ($(\"link[href='\" + globalpath + \"']\").length === 0) {\n                    var link = document.createElement('link');\n                    link.type = 'text/css';\n                    link.rel = 'stylesheet';\n                    link.href = globalpath;\n                    document.getElementsByTagName(\"head\")[0].appendChild(link);\n                }\n            },\n            add_doghnut_patterns_definitions: function(d3) {\n                // See https://iros.github.io/patternfills/sample_d3.html\n                var availablepatterns = [\n                    {\n                        pattername: 'doghnut-p1',\n                        // eslint-disable-next-line max-len\n                        imagedef: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHhtbG5zOnhsaW5rPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJyB3aWR0aD0nNicgaGVpZ2h0PSc2Jz4KICA8cmVjdCB3aWR0aD0nNicgaGVpZ2h0PSc2JyBmaWxsPScjZWVlZWVlJy8+CiAgPGcgaWQ9J2MnPgogICAgPHJlY3Qgd2lkdGg9JzMnIGhlaWdodD0nMycgZmlsbD0nI2U2ZTZlNicvPgogICAgPHJlY3QgeT0nMScgd2lkdGg9JzMnIGhlaWdodD0nMicgZmlsbD0nI2Q4ZDhkOCcvPgogIDwvZz4KICA8dXNlIHhsaW5rOmhyZWY9JyNjJyB4PSczJyB5PSczJy8+Cjwvc3ZnPg=='\n                    },\n                ];\n\n                var svgpattern = d3.select('body').select('svg#d3progresspatternsdef');\n                if (svgpattern.empty()) {\n                    d3.select('body')\n                        .append('svg')\n                        .attr('id', 'd3utilspatternsdef')\n                        .append('defs')\n                        .selectAll('pattern')\n                        .data(availablepatterns)\n                        .enter()\n                        .append('pattern')\n                        .attr('id', function(d) {\n                            return d.pattername;\n                        })\n                        .attr('patternUnits', 'userSpaceOnUse')\n                        .attr('width', 10)\n                        .attr('height', 10)\n                        .append('image')\n                        .attr('xlink:href', function(d) {\n                            return d.imagedef;\n                        })\n                        .attr('x', 0)\n                        .attr('y', 0)\n                        .attr('width', 10)\n                        .attr('height', 10);\n                }\n            },\n\n        };\n    }\n);\n"],"file":"d3-utils.min.js"}