{"version":3,"file":"d3-progress.js","sources":["../src/progress.js"],"sourcesContent":["import { axisBottom as d3AxisBottom } from 'd3-axis';\nimport { scaleLinear as d3ScaleLinear } from 'd3-scale';\nimport 'd3-transition';\n\n/**\n * Make a data structure to hold a progress bar with markers\n * @return {progressChart}\n */\nexport default function () {\n  let data = {};\n  let width = 960;\n  let height = 100;\n  let graphMargins = { top: 10, right: 5, bottom: 30, left: 15 }; // Absolute margins\n  let graphWidth = function () { return width - graphMargins.left - graphMargins.right; };\n  let graphHeight = function () { return height - graphMargins.top - graphMargins.bottom; };\n  let marginW = 0.1;\n  let marginH = 0.1;\n\n  let ticksValues = [0, 0.25, 0.50, 0.75, 1];\n\n  // For each small multipleâ€¦\n  function progressCVS (svgitem) {\n\n    // This wrapper contains the graph and the axis\n    let wrap = svgitem\n      .attr('width', width)\n      .attr('height', height)\n      .append('g')\n      .attr('class', 'progress-cvs')\n      .attr('transform', `translate(${graphMargins.left},0)`);\n\n    // This is just the graph without axis\n    let extentX = graphWidth() * (1 - marginW * 2);\n    let extentY = graphHeight() * (1 - marginH * 2);\n    let graphWrap = wrap\n      .append('g')\n      .attr('width', extentX)\n      .attr('height', extentY);\n\n    // Scales\n    const scaleX = d3ScaleLinear()\n      .domain([0, 1])\n      .range([0, extentX]);\n\n    // Draw xscale (tick 0.25)\n\n    let markervalues = data.markers.map(function (d) {\n      return d.value;\n    });\n\n    const tickFormat = function (val) {return Math.round(val * 100);};\n    const tickSize = graphMargins.bottom/3;\n\n    // Add both axes\n    const axismarker = wrap.append('g').attr('class', 'axismarker');\n    axismarker.attr('transform', `translate(0,${extentY})`).call(\n      d3AxisBottom(scaleX)\n        .tickValues(markervalues.sort())\n        .tickFormat(tickFormat)\n        .tickSize(tickSize)\n    );\n\n    const axisgraph = wrap.append('g').attr('class', 'axisgraph');\n    axisgraph.attr('transform', `translate(0,${extentY})`).call(\n      d3AxisBottom(scaleX)\n        .tickValues(ticksValues)\n        .tickFormat(tickFormat)\n        .tickSize(tickSize)\n    );\n    // Fixup style\n    axisgraph.select('.domain').remove();\n    axismarker.select('.domain').remove();\n    axisgraph.attr('font-size', tickSize); // 80% of the margin\n    axismarker.attr('font-size', tickSize); // 80% of the margin\n\n    // Draw grey background\n    graphWrap.append('rect')\n      .attr('class', 'background-bar')\n      .attr('width', extentX)\n      .attr('height', extentY)\n      .attr('rx', extentY * marginH)\n      .attr('ry', extentY * marginH)\n      .attr('x', 0)\n      .attr('y', 0);\n\n    // Draw results\n    let barHeight = function (index) { return extentY * (1 - marginH * (index + 1) * 4); };\n    let barMiddlePosition = function (index) { return extentY / 2 - barHeight(index) / 2; };\n\n    graphWrap.selectAll('rect.results')\n      .data(data.results)\n      .enter()\n      .append('rect')\n      .attr('class', function (d) { return 'results competency-type-bar-' + ((d.type)?d.type:1);})\n      .attr('width', function (r) { return scaleX(r.value);})\n      .attr('height', function (_d, index) {return barHeight(index);})\n      .attr('rx', extentY * marginH)\n      .attr('rx', extentY * marginH)\n      .attr('x', 0)\n      .attr('y', function (_d, index) { return barMiddlePosition(index);});\n    // Draw markers\n    let circleRadius = function (data) { return extentY * (1 - marginH * (data.active ? 2 : 4)) / 3; };\n\n    let marker = graphWrap.selectAll('g.marker')\n      .data(data.markers)\n      .enter()\n      .append('g')\n      .attr('class', function (d) {return d.active ? 'marker active' : 'marker';})\n      .attr('x', function (r) { return scaleX(r.value);})\n      .attr('y', 0);\n\n    marker.append('circle')\n      .attr('r', circleRadius)\n      .attr('cx', function (r) { return scaleX(r.value);})\n      .attr('cy', extentY / 2);\n\n    marker.append('text')\n      .attr('x', function (r) { return scaleX(r.value);})\n      .attr('y', extentY / 2)\n      .text(function (d) {return d.label;})\n      .attr('class', 'marker-text')\n      .attr('font-size', extentY * (1 - marginH) / 3);\n  }\n\n  progressCVS.width = function (_) {\n    if (!arguments.length) return width;\n    width = +_;\n    return this;\n  };\n\n  progressCVS.height = function (_) {\n    if (!arguments.length) return height;\n    height = +_;\n    return this;\n  };\n\n  progressCVS.margins = function (_) {\n    if (!arguments.length) return graphMargins;\n    graphMargins = _;\n    return this;\n  };\n\n  progressCVS.data = function (_) {\n    if (!arguments.length) return data;\n    data = _;\n    return this;\n  };\n\n  return progressCVS;\n}\n\n\n"],"names":["d3ScaleLinear","d3AxisBottom"],"mappings":"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"}