{"version":3,"file":"d3-progress.min.js","sources":["../src/progress.js"],"sourcesContent":["import { axisBottom as d3AxisBottom } from 'd3-axis';\nimport { scaleLinear as d3ScaleLinear } from 'd3-scale';\nimport { symbol as d3Symbol, symbolTriangle as d3SymbolTriangle } from 'd3-shape';\n\n/**\n * Make a data structure to hold a progress bar with markers\n * @return {progressChart}\n */\nexport default function () {\n  let data = {};\n  let width = 960;\n  let height = 100;\n  let graphMargins = { top: 10, right: 5, bottom: 30, left: 15 }; // Absolute margins\n  let graphWidth = function () { return width - graphMargins.left - graphMargins.right; };\n  let graphHeight = function () { return height - graphMargins.top - graphMargins.bottom; };\n  let marginW = 0.1;\n  let marginH = 0.1;\n\n  let ticksValues = [0, 0.25, 0.50, 0.75, 1];\n\n  // For each small multipleâ€¦\n  function progressCVS (svgitem) {\n\n    // This wrapper contains the graph and the axis\n    let wrap = svgitem\n      .attr('width', width)\n      .attr('height', height)\n      .append('g')\n      .attr('class', 'progress-cvs')\n      .attr('transform', `translate(${graphMargins.left},0)`);\n\n    // Then for each bar/results, we need to loop through and get the progress bar\n\n    // This is just the graph without axis\n    let extentX = graphWidth() * (1 - marginW * 2);\n    let extentY = graphHeight() * (1 - marginH * 2);\n    let graphWrap = wrap\n      .append('g')\n      .attr('width', extentX)\n      .attr('height', extentY);\n\n    // Scales\n    const scaleX = d3ScaleLinear()\n      .domain([0, 1])\n      .range([0, extentX]);\n\n    // Draw grey background\n    graphWrap.append('rect')\n      .attr('class', 'background-bar')\n      .attr('width', extentX)\n      .attr('height', extentY)\n      .attr('rx', extentY * marginH)\n      .attr('ry', extentY * marginH)\n      .attr('x', 0)\n      .attr('y', 0);\n\n    const tickFormat = function (val) {return Math.round(val * 100);};\n    const tickSize = graphMargins.bottom / 3;\n\n    // Add the bottom axes\n    const axisgraph = wrap.append('g').attr('class', 'axisgraph');\n    axisgraph.attr('transform', `translate(0,${extentY})`).call(\n      d3AxisBottom(scaleX)\n        .tickValues(ticksValues)\n        .tickFormat(tickFormat)\n        .tickSize(tickSize)\n    );\n    // Fixup style\n    axisgraph.select('.domain').remove();\n    axisgraph.attr('font-size', tickSize); // 80% of the margin\n\n    // Now the bars\n\n    // Draw results\n    data.forEach(function (currentData, index) {\n      var wrapper = graphWrap.append('g')\n        .attr('width', extentX)\n        .attr('height', extentY / data.length)\n        .attr('rx', extentY * marginH)\n        .attr('ry', extentY * marginH)\n        .attr('class', 'comptype-' + currentData.result.type)\n        .attr('transform', `translate(0,${index * (extentY / data.length)})`);\n\n      progressCVS.barCVS(currentData, wrapper, extentY / data.length, scaleX, extentX);\n    });\n\n    let resultsmarkervalues =\n      data.map(function (r) {\n        return r.result.value;\n      });\n\n    var triangleSize = graphWidth() / 50;\n    const resultsmarker = wrap\n      .selectAll('g.resultmarker')\n      .data(resultsmarkervalues)\n      .enter()\n      .append('g')\n      .attr('class', 'resultmarker')\n      .attr('transform', function (r) {return `translate(${scaleX(r)},${extentY})`;});\n\n    var symbolGenerator = d3Symbol().size(triangleSize).type(d3SymbolTriangle);\n\n    resultsmarker\n      .append('path')\n      .attr('d', function () {\n        return symbolGenerator();\n      });\n\n    resultsmarker\n      .append('text')\n      .attr('dy', function(_d,index){ return triangleSize * (1+ index)*0.7;} )\n      .text(function (d) {return `${Math.round(d* 100)} %`;});\n\n  }\n\n  progressCVS.barCVS = function (currentData, wrapper, maxHeight, scaleX, extentX) {\n    progressCVS.createBar(\n      wrapper,\n      'bar-bg',\n      maxHeight,\n      function () {return extentX;}\n    );\n\n    progressCVS.createBar(\n      wrapper,\n      'bar',\n      maxHeight,\n      function () {return scaleX(currentData.result.value);}\n    );\n\n    // Draw markers\n    let circleRadius = progressCVS.barHeight(maxHeight)/2;\n\n    let marker = wrapper.selectAll('g.marker')\n      .data(currentData.markers)\n      .enter()\n      .append('g')\n      .attr('class', function (d) {return d.active ? 'marker active' : 'marker';})\n      .attr('x', function (r) { return scaleX(r.value);})\n      .attr('y', maxHeight/2);\n\n    marker.append('circle')\n      .attr('r', circleRadius)\n      .attr('cx', function (r) { return scaleX(r.value);})\n      .attr('cy', maxHeight/2);\n\n    marker.append('text')\n      .attr('x', function (r) { return scaleX(r.value);})\n      .attr('y', maxHeight/2)\n      .text(function (d) {return d.label;})\n      .attr('class', 'marker-text')\n      .attr('font-size', maxHeight/2);\n  };\n\n  progressCVS.createBar = function (item, classname, maxHeight, widthCallBack) {\n    item.append('rect')\n      .attr('class', classname)\n      .attr('width', widthCallBack)\n      .attr('height', function () {return progressCVS.barHeight(maxHeight);})\n      .attr('rx', maxHeight * marginH)\n      .attr('ry', maxHeight * marginH)\n      .attr('x', 0)\n      .attr('y', function () { return progressCVS.barMiddlePosition(maxHeight);});\n  };\n\n  progressCVS.barHeight = function (maxHeight) { return maxHeight * (1 - marginH  * 2); };\n  progressCVS.barMiddlePosition = function (maxHeight) { return maxHeight / 2 - progressCVS.barHeight(maxHeight) / 2; };\n\n  progressCVS.width = function (_) {\n    if (!arguments.length) return width;\n    width = +_;\n    return this;\n  };\n\n  progressCVS.height = function (_) {\n    if (!arguments.length) return height;\n    height = +_;\n    return this;\n  };\n\n  progressCVS.margins = function (_) {\n    if (!arguments.length) return graphMargins;\n    graphMargins = _;\n    return this;\n  };\n\n  progressCVS.data = function (_) {\n    if (!arguments.length) return data;\n    data = _;\n    return this;\n  };\n\n  return progressCVS;\n}\n\n\n"],"names":["data","width","height","graphMargins","top","right","bottom","left","graphWidth","graphHeight","marginW","marginH","ticksValues","progressCVS","svgitem","wrap","attr","append","extentX","extentY","graphWrap","scaleX","d3ScaleLinear","domain","range","tickSize","axisgraph","call","d3AxisBottom","tickValues","tickFormat","val","Math","round","select","remove","forEach","currentData","index","wrapper","length","result","type","barCVS","resultsmarkervalues","map","r","value","triangleSize","resultsmarker","selectAll","enter","symbolGenerator","d3Symbol","size","d3SymbolTriangle","_d","text","d","maxHeight","createBar","circleRadius","barHeight","marker","markers","active","label","item","classname","widthCallBack","barMiddlePosition","_","arguments","this","margins"],"mappings":"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"}